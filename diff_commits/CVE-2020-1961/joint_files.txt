license apache software foundation asf one contributor license agreement notice file distribute work additional information copyright ownership asf license file apache license version the license use file compliance license obtain copy license at http www apache org license license require applicable law agree write software distribute license distribute an basi warranty conditions any kind express imply license the specific language govern permission limitations license npackage org apache syncope core provision java jexl nimport java beans introspection exception nimport java beans introspector nimport java beans property descriptor nimport java lang reflect field nimport java util collection nimport java util collection nimport java util date nimport java util hash map nimport java util hash set nimport java util list nimport java util map nimport java util set nimport org apache commons jexl3 jexl builder nimport org apache commons jexl3 jexl context nimport org apache commons jexl3 jexl engine nimport org apache commons jexl3 jexl exception nimport org apache commons jexl3 jexl expression nimport org apache commons jexl3 jxlt engine nimport org apache commons jexl3 map context nimport org apache commons lang3 array utils nimport org apache commons lang3 stre utils nimport org apache syncope common lib to any to nimport org apache syncope common lib to attr to nimport org apache syncope common lib to realm to nimport org apache syncope core spring application context provider nimport org apache syncope core provision api util format utils nimport org apache syncope core persistence api entity any nimport org apache syncope core persistence api entity der schema nimport org apache syncope core persistence api entity plain attr nimport org apache syncope core persistence api entity realm nimport org apache syncope core provision api der attr handler nimport org slf4j logger nimport org slf4j logger factory jexl href http common apache org jexl reference index html reference available npublic jexl utils logger log logger factory get logger jexl utils class password clear password serial version uid map set property descriptor collection class set property descriptor synchronize map hash map set property descriptor jexl engine engine jexl engine get engine log jexl builder uberspect new sandbox uberspect loader new empty class loader namespace collections string singleton map syncope syncope jexl function cache 512 silent false strict false create engine jxlt engine new jxlt engine get engine create jxlt engine false be expression valid final expression result get engine create expression expression result true jexl exception log error invalid jexl expression expression result false result evaluate final expression jexl context jexl context result string util empty string utils be not blank expression jexl context jexl expression jexl expression get engine create expression expression evaluate jexl expression evaluate jexl context evaluate result evaluate to string exception log error error evaluate jexl expression expression log debug expression provide invalid context result add field to context final jexl context jexl context set property descriptor cache cache get object get class cache cached hash set cache put object get class cache property descriptor desc introspector get bean info object get class get property descriptor desc get name start with pc array util contain ignore desc get name iterable class be assignable from desc get property type desc get property type be array cached add desc introspection exception ie log error reading attribute error ie property descriptor desc cached field name desc get name field type desc get property type field value desc get read method field field object get class get declare field field name field set accessible true field value field get object field value desc get read method invoke object field value field value null string util empty field type equal date class format util format date field value false field value jexl context set field name field value log debug add field value field name field value exception iae log error reading value error field name iae object get realm jexl context set realm object get realm get full path any to any to object get realm jexl context set realm any to object get realm realm jexl context set full path realm object get full path realm to jexl context set full path realm to object get full path add attr os to context final collection attr to attrs jexl context jexl context attr to attr attrs attr get schema value attr get value be empty string util empty attr get value size attr get value get attr get value log debug add attribute value attr get schema value jexl context set attr get schema value add plain attrs to context collection plain attr attrs jexl context jexl context plain attr attr attrs attr get schema list attr value attr get value as strings value attr value be empty string util empty attr value size attr value get attr value log debug add attribute value attr get schema get key value jexl context set attr get schema get key value add der attrs to context final jexl context jexl context map der schema der attrs application context provider get bean factory get bean der attr handler class get value any map entry der schema entry der attrs entry set jexl context set entry get key get key entry get value evaluate mandatory condition final mandatory condition jexl context jexl context map context add plain attrs to context any get plain attrs jexl context add der attrs to context any jexl context boolean parse boolean evaluate mandatory condition jexl context constructor class jexl utils license apache software foundation asf one contributor license agreement notice file distribute work additional information copyright ownership asf license file apache license version the license use file compliance license obtain copy license at http www apache org license license require applicable law agree write software distribute license distribute an basi warranty conditions any kind express imply license the specific language govern permission limitations license npackage org apache syncope core provision java jexl nimport java time instant nimport java util arrays nimport java util collection nimport java util collection nimport java util date nimport java util hash set nimport java util list nimport java util map nimport java util optional nimport java util set nimport org apache commons jexl3 jexl engine nimport org apache commons jexl3 internal introspection uberspect nimport org apache commons jexl3 introspection jexl method nimport org apache commons jexl3 introspection jexl property set nimport org apache commons jexl3 introspection jexl uberspect nimport org apache commons log log factory nimport org apache syncope common lib to any to nimport org apache syncope common lib to attr to nimport org apache syncope common lib to membership to nimport org apache syncope common lib to realm to nimport org apache syncope core persistence api entity any nimport org apache syncope core persistence api entity membership nimport org apache syncope core persistence api entity plain attr nimport org apache syncope core persistence api entity realm nclass sandbox uberspect uberspect set collection unmodifiable set new hash set arrays as list contain contain all be empty size iterator to string set collection unmodifiable set new hash set arrays as list get index of last index of to string set collection unmodifiable set new hash set arrays as list get get or default contain key contain value to string sandbox uberspect super log factory get log jexl engine class jexl uberspect strategy override jexl method get constructor final ctor handle arg null override jexl method get method final arg any to any plain attr attr to membership to membership realm realm to super get method obj arg syncope jexl function super get method obj arg optional super get method obj arg obj get class be array super get method obj arg super get method obj arg date instant super get method obj arg map method contain method super get method obj arg list method contain method methods contain method super get method obj arg collection methods contain method super get method obj arg null override jexl property set get property set final identifier arg null override jexl property set get property set list property resolver resolver identifier arg null license apache software foundation asf one contributor license agreement notice file distribute work additional information copyright ownership asf license file apache license version the license use file compliance license obtain copy license at http www apache org license license require applicable law agree write software distribute license distribute an basi warranty conditions any kind express imply license the specific language govern permission limitations license npackage org apache syncope core provision java notification nimport java io string writer nimport java text parse exception nimport java util array list nimport java util collection nimport java util hash map nimport java util hash set nimport java util list nimport java util map nimport java util set nimport org apache commons collections4 iterable utils nimport org apache commons collections4 predicate nimport org apache commons jexl3 map context nimport org apache commons lang3 stre utils nimport org apache commons lang3 tuple pair nimport org apache syncope common lib to group to nimport org apache syncope common lib to user to nimport org apache syncope common lib type audit elements nimport org apache syncope common lib type audit element result nimport org apache syncope common lib type audit logger name nimport org apache syncope common lib to any object to nimport org apache syncope common lib to provision result nimport org apache syncope common lib type any type kind nimport org apache syncope core persistence api dao any match dao nimport org apache syncope core provision java jexl jexl utils nimport org apache syncope core persistence api dao conf dao nimport org apache syncope core persistence api dao notification dao nimport org apache syncope core persistence api dao group dao nimport org apache syncope core persistence api dao task dao nimport org apache syncope core persistence api dao user dao nimport org apache syncope core persistence api dao search order by clause nimport org apache syncope core persistence api entity entity factory nimport org apache syncope core persistence api entity notification nimport org apache syncope core persistence api entity plain attr nimport org apache syncope core persistence api entity group group nimport org apache syncope core persistence api entity task notification task nimport org apache syncope core persistence api entity task task exec nimport org apache syncope core persistence api entity user plain attr nimport org apache syncope core persistence api entity user user nimport org apache syncope core provision api datum group data binder nimport org apache syncope core provision api datum user data binder nimport org apache syncope core persistence api search search cond converter nimport org apache syncope core spring application context provider nimport org apache syncope core persistence api dao any object dao nimport org apache syncope core persistence api dao any search dao nimport org apache syncope core persistence api dao der schema dao nimport org apache syncope core persistence api dao vir schema dao nimport org apache syncope core persistence api entity any nimport org apache syncope core persistence api entity any about nimport org apache syncope core persistence api entity any type nimport org apache syncope core persistence api entity der schema nimport org apache syncope core persistence api entity vir schema nimport org apache syncope core persistence api entity anyobject any object nimport org apache syncope core persistence api entity user membership nimport org apache syncope core provision api der attr handler nimport org apache syncope core provision java int attr name parser nimport org apache syncope core provision api int attr name nimport org apache syncope core provision api vir attr handler nimport org apache syncope core provision api datum any object datum binder nimport org apache syncope core provision api notification notification manager nimport org apache syncope core provision api notification notification recipient provider nimport org apache syncope core provision api event after handle event nimport org slf4j logger nimport org slf4j logger factory nimport org springframework beans factory annotation autowired nimport org springframework beans factory support abstract bean definition nimport org springframework transaction annotation transactional transactional rollback for throwable class npublic default notification manager notification manager logger log logger factory get logger notification manager class autowired der schema dao der schema dao autowired vir schema dao vir schema dao notification dao autowired notification dao notification dao configuration dao autowired conf dao conf dao any object dao autowired any object dao any object dao user dao autowired user dao user dao group dao autowired group dao group dao search dao autowired any search dao search dao autowired any match dao any match dao task dao autowired task dao task dao autowired der attr handler der attr hander autowired vir attr handler vir attr hander autowired user data binder user datum binder autowired group data binder group data binder autowired any object datum binder any object datum binder autowired entity factory entity factory autowired int attr name parser int attr name parser transactional read only true override get max retrie conf dao find notification max retrie 0l create notification task param notification notification model param task about param jexl var jexl variable return notification task fully populated notification task get notification task notification notification any map jexl var vir attr hander get value any list user recipient array list notification get recipient fiql recipient add all search dao user search search cond converter convert notification get recipient fiql collection order by clause empty list any type kind user notification be self as recipient user recipient add user any set recipient email hash set list user to recipient os array list recipient size user recipient recipient vir attr hander get value recipient email get recipient email notification get recipient attr name recipient email log warn notify find recipient notification get recipient attr name recipient email add email recipient os add user datum binder get user to recipient true notification get static recipient recipient email add all notification get static recipient notification get recipient provider class name notification recipients provider recipient provider notification recipients provider application context provider get bean factory create bean class for name notification get recipients provider class name abstract bean definition false recipient email add all recipient provider provide recipient notification exception log error could fetch recipient notification get recipient provider class name jexl var put recipient recipient os jexl var put syncope conf this find all syncope confs jexl var put event notification get event notification task task entity factory new entity notification task class task set notification notification task set entity key any get key task set any type kind any get type get kind task set trace level notification get trace level task get recipient add all recipient email task set sender notification get sender task set subject notification get subject string utils be not blank notification get template get text template task set text body evaluate notification get template get text template jexl var string utils be not blank notification get template get html template task set html body evaluate notification get template get html template jexl var task evaluate final template map jexl var string writer writer string writer jexl util new jxlt engine create template template evaluate new map context jexl var writer writer to string override notification available audit element event category type type category subcategory event success event audit logger name build event type category subcategory event result success failure event audit logger name build event type category subcategory event result failure iterable utils matche any notification dao find all predicate notification override evaluate final notification notification notification be active notification get event contain success event notification get event contain failure event override create task final after handle event event create task event get who event get type event get category event get subcategory event get event event get condition event get before event get output event get input override list notification task create task who audit element event category type type category subcategory event result condition before output input null user to user dao find user to before get key output user to user dao find user to output get key output pair pair output get right user to user dao find user to pair output get right get key output provision result provision result output get entity user to user dao find provisioning result output get entity get key any object to any object dao find any object to before get key output any object to any object dao find any object to output get key output provision result provision result output get entity any object to any object dao find provisioning result output get entity get key group to group dao find group to before get key output group to group dao find group to output get key output provision result provision result output get entity group to group dao find provisioning result output get entity get key any type any type any get type log debug search notification any type any list notification task notification array list notification notification notification dao find all log be debug enable any about notification get about log debug notification define about get any type about get notification be active current event audit logger name build event type category subcategory event condition notification get event contain current event log debug no event find any any type null notification get about any type null any match dao matches search cond converter convert notification get about any type get log debug creating notification task event current event any map model hash map model put who who model put type type model put category category model put subcategory subcategory model put event event model put condition condition model put before before model put output output model put input input user model put user user data binder get user to user true group model put group group data binder get group to group true any object model put any object any object datum binder get any object to any object true notification task notification task get notification task notification model notification task task dao save notification task notification add notification task log debug notification active task create notification get key notification get recipient email final recipient attr name user user email null int attr name int attr name int attr name int attr name parser parse recipient attr name any type kind user parse exception log error invalid int attr name specify recipient ignore recipient attr name email username equal int attr name get field email user get username int attr name get schema type membership membership null int attr name get membership of group group group group dao find by name int attr name get membership of group group membership user get membership group get key int attr name get schema type plain plain attr attr membership null user get plain attr recipient attr name user get plain attr recipient attr name membership attr email attr get value as strings be empty attr get value as string get break derive der schema schema der schema dao find recipient attr name schema log warn ignoring non existing der schema class get simple name recipient attr name email membership null der attr hander get value user schema der attr hander get value user membership schema break virtual vir schema vir schema vir schema dao find recipient attr name vir schema log warn ignoring non existing vir schema class get simple name recipient attr name list vir attr value membership null vir attr hander get value user vir schema vir attr hander get value user membership vir schema email vir attr value be empty vir attr value get break default email override task exec store exec final task exec execution notification task task task dao find execution get task get key task add execution task set execute true task dao save task flush need generate value execution key task dao flush execution override set task execute final task key execute notification task task task dao find task key task set execute execute task dao save task override count execution with status final task key status notification task task task dao find task key count task exec task exec task get execs status task exec get status count status equal task exec get status count count map find all syncope confs map syncope conf map hash map plain attr attr conf dao get get plain attrs syncope conf map put attr get schema get key attr get value as string get syncope conf map 