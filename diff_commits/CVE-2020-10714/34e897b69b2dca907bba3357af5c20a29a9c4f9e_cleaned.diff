boss home professional open source copyright red hat inc individual contributors indicate author tags license apache license version license use file compliance license obtain copy license at http www apache org license license require applicable law agree writing software distribute license distribute basis warranty conditions kind express imply license specific language govern permission and limitation license npackage org wildfly security http impl nimport java util array fill nimport org wildfly common assert check not null param nimport org wildfly security elytron message http form nimport org wildfly security http http constant path nimport org wildfly security http http constant page nimport org wildfly security http http constant page nimport org wildfly security http http constant location nimport org wildfly security http http constant name nimport org wildfly security http http constant find nimport org wildfly security http http constant http nimport org wildfly security http http constant https nimport org wildfly security http http constant location nimport org wildfly security http http constant post nimport java io io exception nimport java io input stream nimport java io output stream nimport java net uri nimport java util map nimport javax security auth callback callback nimport javax security auth callback callback handler nimport javax security auth callback unsupported callback exception nimport org wildfly security auth callback cached identity authorize callback nimport org wildfly security auth server security identity nimport org wildfly security cache cache identity nimport org wildfly security cache identity cache nimport org wildfly security http http authentication exception nimport org wildfly security http http scope nimport org wildfly security http http server mechanism responder nimport org wildfly security http http server request nimport org wildfly security http http server response nimport org wildfly security http scope generic form authentication mechanism usable number different scenario author href mailto darran lofthouse jboss com darran lofthouse nfinal form authentication mechanism username password authentication mechanism configurable defer prove demand username username password password form authentication mechanism class get name location form authentication mechanism class get name elytron identity check context path login page error page post location form authentication mechanism final callback handler callback handler map property super check not null param callback handler callback handler check not null param property property post location property get config location this post location post location post location location context path property contain key config property get config login page property get config page error page property get config page override get mechanism name name see org wildfly security http http server authentication mechanism evaluate request org wildfly security http http server request override evaluate request final http server request request http authentication exception authenticate base previously cache identity attempt re authentication request return current request authentication attempt post equal request get request method be authentication request request get request uri get path attempt authentication request return register challenger login page request no authentication in progress response send login requ response be authentication request final path last slash path last index of path param path index of last slash last slash target path substring last slash last slash path param path param path length target equal post location identity cache create identity cache http server request request identity cache override put security identity identity http scope session get session scope request true session session exist return session set attachment cache cached identity get mechanism name identity override cached identity http scope session get session scope request false session session exist null cached identity session get attachment cache key override cached identity remove http scope session get session scope request false session session exist null cached identity cached identity get session set attachment cache null cache identity error string message http server request request request authentication fail message response send page error page request response attempt authentication http server request request http authentication exception username request get first parameter value username password request get first parameter value password username username length password error http form username or password miss request return password chars password to char array authenticate null username password chars identity cache identity cache create identity cache request authorize username request identity cache http form debugf user authenticate successfully username succeed http scope session get session scope request true http server mechanism responder responder null session session exist post authentication path original path session get attachment location string class original path post authentication path original path http form tracef user redirect original path post authentication path uri request uri request get request uri current path request uri get path string builder sb string builder scheme request uri get scheme sb append scheme sb append sb append request uri get host port request uri get port append port scheme port sb append append port sb append current path substre current path index of default location post authentication path sb to string http form tracef user redirect path post authentication path session set attachment location null responder response send redirect response post authentication path request authentication complete responder identity cache remove resume request need redirect first return http form debugf user authorization fail username fail and redirect to error page request username return http form debugf user authentication fail username fail and redirect to error page request username return io exception unsupported callback exception http authentication exception fill password chars 0x00 authorize string username http server request request identity cache identity cache http authentication exception http form tracef authorizing username request uri context path username request get request uri this context path identity cache cached identity authorize callback authorize callback cached identity authorize callback username identity cache callback handler handle new callback authorize callback authorize callback be authorize io exception unsupported callback exception http authentication exception super authorize username attempt re authentication http server request request http authentication exception http form be trace enable http scope session scope get session scope request false session scope session scope exist http form tracef try authenticate session request uri context path session scope get pron request get request uri this context path http form tracef try authenticate session attach follow request request uri context path request get request uri this context path identity cache identity cache create identity cache request identity cache cached identity authorize callback authorize callback cached identity authorize callback identity cache callback handler handle new callback authorize callback io exception unsupported callback exception http authentication exception authorize callback be authorize succeed io exception unsupported callback exception http authentication exception request authentication complete null identity cache remove request resume request true false fail and redirect to error page http server request request username io exception unsupported callback exception identity cache identity cache create identity cache request identity cache identity cache remove fail error http form authorization fail username request send login http server request request http server response response http authentication exception save current request uri request uri request get request uri http scope session get session scope request true session session support attachment string builder sb string builder scheme request uri get scheme sb append scheme sb append sb append request uri get host port request uri get port append port scheme port sb append append port sb append request uri get path if request uri get raw query sb append sb append request uri get raw query if request uri get raw fragment sb append sb append request uri get raw fragment todo need way update jsessionid path parameter session id change see undertow 958 details session set attachment location sb to string request suspend request send page login page request response send page stre page http server request request http server response response http authentication exception response forward page return work send login page http scope application request get scope scope application application application support resource input stream page stream application get resource page page stream output stream response stream response get output stream response stream content byte 1024 length length page stream read content response stream write content length return io exception http authentication exception uri request uri request get request uri string builder sb string builder scheme request uri get scheme sb append scheme sb append sb append request uri get host port request uri get port append port scheme port sb append append port sb append context path sb append page send redirect response sb to string send redirect http server response response location response add response header location location response set status code find http scope get session scope http server request request create session http scope scope request get scope scope session scope scope exist create session scope create scope append port final scheme port port http equal ignore case scheme port https equal ignore case scheme port 443